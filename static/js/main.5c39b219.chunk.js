(this["webpackJsonpnyt-crossword-stats"]=this["webpackJsonpnyt-crossword-stats"]||[]).push([[0],{120:function(e,t,a){},121:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(39),i=a.n(s),o=(a(87),a(3)),u=a(1),l=a(7),c=a(8),d=a(9),h=(a(88),a(2));a(89);function m(e,t){return e.replace(/\{(\w+?)\}/g,(function(e,a){return t[a]}))}function v(e,t){return[new Date(e,t,1),new Date(e,t+1,0)]}function f(e,t,a){var n=new Date(e,t+a,1);return[n.getFullYear(),n.getMonth()]}function p(e){return e.toISOString().split("T")[0]}function g(e,t,a){for(var n=[],r=e;r<=t;)n.push(r),r+=a;return n}var b=function(){function e(t){Object(o.a)(this,e),this._items=[],this.size=t,this.nextIndex=0}return Object(u.a)(e,[{key:"add",value:function(e){this._items.length<this.size?this._items.push(e):this._items[this.nextIndex]=e,this.nextIndex=(this.nextIndex+1)%this.size}},{key:"items",value:function(){return this._items}}]),e}(),y=function(){function e(t,a){Object(o.a)(this,e),this.size=t,this.runningCount=0,this.queue=[],this.results=[],this.onRequestComplete=a,this.onRequestsComplete=function(){},this.started=!1,this.numRequests=0}return Object(u.a)(e,[{key:"addRequest",value:function(e){if(this.started)throw new Error("Pool already started");this.queue.push(e),this.numRequests++}},{key:"start",value:function(){if(this.started)throw new Error("Pool already started");this.started=!0;for(var e=0;e<this.size&&e<this.numRequests;e++){var t=this.queue.pop(0);this.executeRequest(t)}}},{key:"poll",value:function(){var e=this;if(!this.started)throw new Error("Not started");return 0===this.runningCount&&0===this.queue.length?Promise.resolve(this.results):new Promise((function(t,a){e.onRequestsComplete=t}))}},{key:"executeRequest",value:function(e){var t=this;this.runningCount++,e().then((function(e){t.results.push(e),t.runningCount--,t.onRequestComplete(t.results.length,t.numRequests),t.maybeProcessNextRequest()}))}},{key:"maybeProcessNextRequest",value:function(){if(0===this.runningCount&&0===this.queue.length&&this.onRequestsComplete(this.results),this.runningCount<this.size&&this.queue.length>0){var e=this.queue.pop(0);this.executeRequest(e)}}}]),e}(),D=function(e){Object(d.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={userId:"77239038",userCookie:"",dateRangeOption:"this_year"},n.setUserId=n.setUserId.bind(Object(l.a)(n)),n.setUserCookie=n.setUserCookie.bind(Object(l.a)(n)),n.setDateRangeOption=n.setDateRangeOption.bind(Object(l.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(l.a)(n)),n.submit=n.submit.bind(Object(l.a)(n)),n.handleKeyPress=n.handleKeyPress.bind(Object(l.a)(n)),n.userCookieInputRef=r.a.createRef(),n}return Object(u.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"UserForm"},r.a.createElement("div",{className:"UserForm-header"},"User Information"),r.a.createElement("div",{className:"UserForm-instructions"},r.a.createElement("div",{className:"UserForm-instructionsHeader"},"Instructions"),r.a.createElement("ol",null,r.a.createElement("li",null,"Log into\xa0",r.a.createElement("a",{href:"https://myaccount.nytimes.com/seg"},"https://myaccount.nytimes.com/seg"),"\xa0and copy your user id"),r.a.createElement("li",null,"Go to any NYTimes page and copy the value for the NYT-S cookie"))),r.a.createElement("form",{className:"UserForm-form",onSubmit:this.handleSubmit}," ",r.a.createElement("div",{className:"UserForm-fields"},r.a.createElement("div",{id:"UserForm-userId",className:"UserForm-field"},r.a.createElement("label",{className:"UserForm-label"},"User ID"),r.a.createElement("input",{className:"UserForm-fieldInput",id:"UserForm-userIdInput",type:"text",value:this.state.userId,onChange:this.setUserId})),r.a.createElement("div",{id:"UserForm-dateRange",className:"UserForm-field"},r.a.createElement("label",{className:"UserForm-label"},"Date Range"),r.a.createElement("select",{name:"dateRange",id:"UserForm-dateRangeInput",className:"UserForm-fieldInput",value:this.state.dateRangeOption,onChange:this.setDateRangeOption},r.a.createElement("option",{value:"this_year"},"This year"),r.a.createElement("option",{value:"last_year"},"Last year"),r.a.createElement("option",{value:"last_3"},"Last 3 months"),r.a.createElement("option",{value:"last_12"},"Last 12 months"),r.a.createElement("option",{value:"last_24"},"Last 2 years"),r.a.createElement("option",{value:"last_60"},"Last 5 years"))),r.a.createElement("div",{id:"UserForm-userCookie",className:"UserForm-field"},r.a.createElement("label",{className:"UserForm-label"},"NYT-S Cookie"),r.a.createElement("textarea",{className:"UserForm-fieldInput",id:"UserForm-userCookieInput",type:"text",value:this.state.userCookie,onChange:this.setUserCookie,onKeyPress:this.handleKeyPress,ref:this.userCookieInputRef}))),r.a.createElement("input",{className:"UserForm-submitButton",type:"submit"})))}},{key:"handleSubmit",value:function(e){e.preventDefault(),this.submit()}},{key:"getDateRangeFromOption",value:function(){var e=new Date,t=v(e.getFullYear(),e.getMonth()),a=Object(h.a)(t,2),n=a[0],r=a[1];switch(this.state.dateRangeOption){case"this_year":return[new Date(e.getFullYear(),0,1),r];case"last_year":return[new Date(e.getFullYear()-1,0,1),new Date(e.getFullYear(),0,0)];case"last_3":var s=f(n.getFullYear(),n.getMonth(),-2),i=Object(h.a)(s,2),o=i[0],u=i[1];return[new Date(o,u),r];case"last_12":var l=f(n.getFullYear(),n.getMonth(),-11),c=Object(h.a)(l,2),d=c[0],m=c[1];return[new Date(d,m),r];case"last_24":var p=f(n.getFullYear(),n.getMonth(),-23),g=Object(h.a)(p,2),b=g[0],y=g[1];return[new Date(b,y),r];case"last_60":var D=f(n.getFullYear(),n.getMonth(),-59),k=Object(h.a)(D,2),w=k[0],C=k[1];return[new Date(w,C),r];default:throw new Error("Invalid selection")}}},{key:"submit",value:function(){this.userCookieInputRef.current.blur();var e=this.getDateRangeFromOption(),t=Object(h.a)(e,2),a=t[0],n=t[1];this.props.onSubmit({userId:this.state.userId,userCookie:this.state.userCookie,startDate:a,endDate:n})}},{key:"handleKeyPress",value:function(e){13===e.charCode&&(this.submit(),e.preventDefault())}},{key:"setDateRangeOption",value:function(e){this.setState({dateRangeOption:e.target.value})}},{key:"setUserId",value:function(e){this.setState({userId:e.target.value})}},{key:"setUserCookie",value:function(e){this.setState({userCookie:e.target.value})}}]),a}(r.a.Component),k=function(){function e(t){Object(o.a)(this,e),this.data=t}return Object(u.a)(e,[{key:"blob",value:function(){try{return{id:this.id(),date:this.date(),day:this.day(),attempted:this.attempted(),solved:this.solved(),cleanlySolved:this.cleanlySolved(),solveTime:this.solveTime(),solveDate:this.solveDate()}}catch(e){throw new Error("failed to extract data: "+JSON.stringify(this.data))}}},{key:"id",value:function(){return this.data.puzzle_id}},{key:"date",value:function(){return this.data.print_date}},{key:"day",value:function(){return function(e){var t=new Date(e);return new Date(t.getTime()+60*t.getTimezoneOffset()*1e3)}(this.data.print_date).getDay()}},{key:"attempted",value:function(){return void 0!==this.data.firsts}},{key:"solved",value:function(){return this.data.solved}},{key:"cleanlySolved",value:function(){return this.solved()&&void 0===this.data.firsts.checked}},{key:"solveTime",value:function(){return this.solved()&&void 0!==this.data.calcs.secondsSpentSolving?this.data.calcs.secondsSpentSolving:-1}},{key:"solveDate",value:function(){return this.solved()?p(new Date(1e3*this.data.firsts.solved)):-1}}]),e}(),w=function(e){Object(d.a)(a,e);var t=Object(c.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).data={},e.state={loaded:!1,data:{},progress:""},e}return Object(u.a)(a,[{key:"componentDidUpdate",value:function(e,t){t.numPendingRequests>0&&0===this.state.numPendingRequests&&this.setState({loaded:!0}),this.props.startDate.getTime()===e.startDate.getTime()&&this.props.endDate.getTime()===e.endDate.getTime()||(this.setState({loaded:!1}),this.fetch())}},{key:"componentDidMount",value:function(){this.fetch()}},{key:"render",value:function(){return!1===this.state.loaded?"Loading "+this.state.progress:this.props.render(this.state.data)}},{key:"fetch",value:function(){var e=this,t=[this.props.startDate.getFullYear(),this.props.startDate.getMonth()],a=t[0],n=t[1],r=[this.props.endDate.getFullYear(),this.props.endDate.getMonth()],s=function(e,t,a,n){for(var r=[],s=new Date(a,n),i=new Date(e,t);i.getTime()<=s.getTime();)r.push([i.getFullYear(),i.getMonth()]),i=new Date(i.getFullYear(),i.getMonth()+1);return r}(a,n,r[0],r[1]),i=new y(20,(function(t,a){e.setState({progress:t+"/"+a+" months"})}));s.forEach((function(t){var a=Object(h.a)(t,2),n=a[0],r=a[1],s=new Date(n,r,1);void 0===e.data[p(s)]&&i.addRequest((function(){return e.fetchMonth(n,r)}))})),i.start(),i.poll().then((function(t){t.filter((function(e){return null!==e.results})).forEach((function(t){return e.processMonthData(t)})),e.setState({progress:"puzzle data"}),e.fetchPuzzles()}))}},{key:"fetchMonth",value:function(e,t){var n=v(e,t),r=Object(h.a)(n,2),s=r[0],i=r[1];return window.fetch(m(a.ARCHIVE_URL,{uid:this.props.userId,start_date:p(s),end_date:p(i)})).then((function(e){return e.json()}))}},{key:"processMonthData",value:function(e){var t=this;e.results.forEach((function(e){t.data[e.print_date]=e}))}},{key:"fetchPuzzles",value:function(){var e=this,t=new y(20,(function(t,a){e.setState({progress:t+"/"+a+" puzzles"})}));Object.keys(this.data).forEach((function(a){!e.data[a].solved&&0===e.data[a].percent_filled||void 0!==e.data[a].calcs||t.addRequest((function(){return e.fetchPuzzle(a)}))})),t.start(),t.poll().then((function(t){t.forEach((function(t){var a=Object(h.a)(t,2),n=a[0],r=a[1];e.data[n].calcs=r.calcs,e.data[n].firsts=r.firsts}));var a=Object.values(e.data).map((function(e){return new k(e).blob()}));e.setState({loaded:!0,data:a})}))}},{key:"fetchPuzzle",value:function(e){var t=this.data[e].puzzle_id;return window.fetch(m(a.GAME_URL,{gid:t}),{headers:{"nyt-s":this.props.userCookie}}).then((function(e){return e.json()})).then((function(t){return[e,t]}))}}]),a}(r.a.Component);w.ARCHIVE_URL="https://nyt-games-prd.appspot.com/svc/crosswords/v3/{uid}/puzzles.json?publish_type=daily&sort_order=asc&sort_by=print_date&date_start={start_date}&date_end={end_date}",w.GAME_URL="https://nyt-games-prd.appspot.com/svc/crosswords/v6/game/{gid}.json";var C=w,O=a(11),E=a(40),S=a(10),T=(a(120),function(e){Object(d.a)(a,e);var t=Object(c.a)(a);function a(){var e;Object(o.a)(this,a);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={timeWindow:60,windowSize:10,useSolveDate:!1},e}return Object(u.a)(a,[{key:"componentDidMount",value:function(){var e=this;setTimeout((function(){return e.draw()}),0)}},{key:"componentDidUpdate",value:function(){var e=this;setTimeout((function(){return e.draw()}),0)}},{key:"draw",value:function(){var e=this,t=this;function a(e){return e.solved?"Solved":e.attempted?"In Progress":"Not Started"}this.ndx=E(this.props.data);var n=this.ndx.dimension((function(t){var a=e.state.useSolveDate?t.solveDate:t.date;return S.e.floor(new Date(a))})),r=n.group().reduce((function(e,t){return t.solved?e.solved+=1:t.attempted?e.attempted+=1:e.not_started+=1,e}),(function(e,t){return t.solved?e.solved-=1:t.attempted?e.attempted-=1:e.not_started-=1,e}),(function(){return{attempted:0,solved:0,not_started:0}})),s=O.barChart("#DataVisualizer-dateChart");s.width(1e3).height(150).margins({left:100,right:50,top:5,bottom:30}).dimension(n).group(r,"Solved",(function(e){return e.value.solved})).stack(r,"In Progress",(function(e){return e.value.attempted})).stack(r,"Not Started",(function(e){return e.value.not_started})).elasticY(!0).x(S.c().domain([this.props.startDate.getTime(),this.props.endDate.getTime()])).round(S.e.floor).xUnits(S.f),s.legend(O.legend()),s.render();var i=n.group().reduce((function(e,t){return t.solved&&(e.totalTime+=t.solveTime,e.numSolved++,e.avgTime=e.numSolved?e.totalTime/e.numSolved:0),e}),(function(e,t){return t.solved&&(e.totalTime-=t.solveTime,e.numSolved--,e.avgTime=e.numSolved?e.totalTime/e.numSolved:0),e}),(function(){return{totalTime:0,numSolved:0,avgTime:0}}));var o,u=(o=i,{all:function(){var e=new b(t.state.windowSize);return o.all().map((function(t){e.add(t.value);var a=e.items().reduce((function(e,t){return e.totalTime+=t.totalTime,e.numSolved+=t.numSolved,e}),{totalTime:0,numSolved:0}),n=a.numSolved>0?a.totalTime/a.numSolved:0;return{key:t.key,value:n}}))}}),l=new O.LineChart("#DataVisualizer-solveTimeOverTimeChart");l.width(1e3).height(400).margins({left:30,right:50,top:10,bottom:30}).dimension(n).group(u).rangeChart(s).brushOn(!1).mouseZoomable(!0).curve(S.a.alpha(.5)).x(S.c().domain([this.props.startDate.getTime(),this.props.endDate.getTime()])).round(S.e.floor).xUnits(S.f).elasticY(!0).yAxisPadding(60),l.yAxis().tickValues(g(0,90,5).map((function(e){return 60*e}))).tickFormat((function(e){return Math.floor(e/60)})),l.render();var c=this.ndx.dimension((function(e){return Math.floor(e.solveTime/60)})),d=c.group((function(e){return 2*Math.floor(e/2)})),h=new O.BarChart("#DataVisualizer-timeDistributionChart");h.width(1e3).height(400).margins({left:100,right:50,top:10,bottom:30}).dimension(c).group(d).round((function(e){return Math.floor(e)})).x(S.b().domain([0,this.state.timeWindow])).xUnits((function(){return e.state.timeWindow/2})).elasticY(!0),h.render();var m=this.ndx.dimension((function(e){return e.day})),v=m.group(),f=["Su","M","Tu","W","Th","Fr","Sa"],p=new O.PieChart("#DataVisualizer-dayChart");p.width(200).height(200).dimension(m).group(v).label((function(e){return"".concat(f[e.key]," (").concat(e.value,")")})),p.render();var y=this.ndx.dimension(a),D=y.group(),k=new O.PieChart("#DataVisualizer-statusChart");k.width(200).height(200).dimension(y).group(D).label((function(e){return"".concat(e.key," (").concat(e.value,")")})),k.render();var w=this.ndx.dimension((function(e){return e.day})),C=w.group().reduce((function(e,t){return t.solved&&e.solved++,e.total++,e.solvePct=Math.round(100*e.solved/e.total),e}),(function(e,t){return t.solved&&e.solved--,e.total--,e.solvePct=0===e.total?0:Math.round(100*e.solved/e.total),e}),(function(){return{solved:0,total:0,solvePct:0}})),T=new O.RowChart("#DataVisualizer-solveRateChart");T.width(220).height(230).margins({left:10,top:0,bottom:30,right:20}).dimension(w).group(C).valueAccessor((function(e){return e.value.solvePct})).label((function(e){return"".concat(f[e.key]," (").concat(e.value.solvePct,"%)")})),T.render();var I=w.group().reduce((function(e,t){return t.solved&&(e.totalTime+=t.solveTime,e.numSolved++,e.avgTime=e.numSolved?e.totalTime/e.numSolved:0),e}),(function(e,t){return t.solved&&(e.totalTime-=t.solveTime,e.numSolved--,e.avgTime=e.numSolved?e.totalTime/e.numSolved:0),e}),(function(){return{totalTime:0,numSolved:0,avgTime:0}})),j=new O.RowChart("#DataVisualizer-solveTimeChart");j.width(220).height(230).margins({left:10,top:0,bottom:30,right:20}).elasticX(!0).dimension(w).group(I).valueAccessor((function(e){return e.value.avgTime})).label((function(e){return"".concat(f[e.key]," (").concat(function(e){var t=Math.floor(e/60),a=Math.floor(e-60*t),n=a<10?"0"+a:a;return"".concat(t,":").concat(n)}(e.value.avgTime),")")})),j.xAxis().ticks(4).tickValues(g(0,this.state.timeWindow,15).map((function(e){return 60*e}))).tickFormat((function(e){return Math.floor(e/60)})),j.render();var z=this.ndx.dimension((function(t){var a=e.state.useSolveDate?t.solveDate:t.date;return S.d.floor(new Date(a))})),R=new O.DataTable("#DataVisualizer-dataTable");R.dimension(z).size(100).columns(["date","solveDate",{label:"Day",format:function(e){return f[e.day]}},{label:"Status",format:function(e){return a(e)}},"solveTime"]).on("renderlet",(function(e){e.selectAll(".dc-table-group").classed("info",!0)})),R.render()}},{key:"render",value:function(){return r.a.createElement("div",{className:"DataVisualizer"},r.a.createElement("div",{className:"DataVisualizer-charts"},r.a.createElement("div",{id:"DataVisualizer-col1",className:"DataVisualizer-col"},r.a.createElement(I,{title:"Average completion time over time (minutes, smoothed)",chartId:"solveTimeOverTimeChart"}),r.a.createElement(I,{title:"Completion time distribution (minutes)",chartId:"timeDistributionChart"}),r.a.createElement(I,{title:"Puzzles by week",chartId:"dateChart"})),r.a.createElement("div",{id:"DataVisualizer-col2",className:"DataVisualizer-col"},r.a.createElement(I,{title:"By day",chartId:"dayChart"}),r.a.createElement(I,{title:"By status",chartId:"statusChart"}),r.a.createElement(I,{title:"Completion rate",chartId:"solveRateChart"}),r.a.createElement(I,{title:"Average completion time",chartId:"solveTimeChart"}))),r.a.createElement("table",{className:"table table-hover",id:"DataVisualizer-dataTable"}))}}]),a}(r.a.Component)),I=function(e){Object(d.a)(a,e);var t=Object(c.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(u.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"DataVisualizer-chartSection"},r.a.createElement("div",{className:"DataVisualizer-chartHeader"},this.props.title),r.a.createElement("div",{id:"DataVisualizer-".concat(this.props.chartId)}))}}]),a}(r.a.Component),j=function(e){Object(d.a)(a,e);var t=Object(c.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).renderVisualization=e.renderVisualization.bind(Object(l.a)(e)),e}return Object(u.a)(a,[{key:"render",value:function(){return r.a.createElement(C,{userId:this.props.userId,userCookie:this.props.userCookie,render:this.renderVisualization,startDate:this.props.startDate,endDate:this.props.endDate})}},{key:"renderVisualization",value:function(e){return r.a.createElement(T,{data:e,startDate:this.props.startDate,endDate:this.props.endDate})}}]),a}(r.a.Component),z=function(e){Object(d.a)(a,e);var t=Object(c.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).state={userId:null,userCookie:null,startDate:new Date(2020,0,1),endDate:new Date(2020,9,1)},e.onInputUserDetails=e.onInputUserDetails.bind(Object(l.a)(e)),e}return Object(u.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(D,{onSubmit:this.onInputUserDetails}),this.state.userId?r.a.createElement(j,{userId:this.state.userId,userCookie:this.state.userCookie,startDate:this.state.startDate,endDate:this.state.endDate,key:this.state.userId}):null)}},{key:"onInputUserDetails",value:function(e){this.setState(e)}}]),a}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(z,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},82:function(e,t,a){e.exports=a(121)},87:function(e,t,a){},88:function(e,t,a){},89:function(e,t,a){}},[[82,1,2]]]);
//# sourceMappingURL=main.5c39b219.chunk.js.map